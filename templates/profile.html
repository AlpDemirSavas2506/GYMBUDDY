{% extends "base.html" %}
{% block title %}Profile - GymBuddy{% endblock %}
{% block content %}
<h1>Your Profile</h1>
<p>View and update your personal information here.</p>

<!-- Profile Update Form -->
<form id="profile-form" method="POST">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.username.label }}
        {{ form.username(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.name.label }}
        {{ form.name(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.surname.label }}
        {{ form.surname(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.email.label }}
        {{ form.email(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.phone_number.label }}
        {{ form.phone_number(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.emergency_contact_name.label }}
        {{ form.emergency_contact_name(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.emergency_contact_number.label }}
        {{ form.emergency_contact_number(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.height.label }}
        {{ form.height(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.weight.label }}
        {{ form.weight(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.blood_type.label }}
        {{ form.blood_type(class="form-control") }}
    </div>
    <button type="submit" class="btn btn-primary">Update Profile</button>
</form>

<hr>

<!-- Verification Code Section -->
<h2>Email Verification</h2>
<p>If you need to verify your email, send a verification code and enter it below.</p>

<!-- Send Verification Code Form -->
<button id="send-code-btn" class="btn btn-secondary">Send Verification Code</button>

<!-- Verification Code Input -->
<div id="verification-section" class="mt-3" style="display: none;">
    <div class="form-group">
        <label for="verification_code">Enter Verification Code</label>
        <input type="text" id="verification_code" class="form-control" placeholder="Enter the code sent to your email">
    </div>
    <button id="verify-code-btn" class="btn btn-primary">Verify Code</button>
</div>

<!-- Password Update Section -->
<div id="password-section" class="mt-3" style="display: none;">
    <h3>Change Your Password</h3>
    <div class="form-group">
        <label for="new_password">New Password</label>
        <input type="password" id="new_password" class="form-control" placeholder="Enter your new password">
    </div>
    <div class="form-group">
        <label for="confirm_password">Confirm New Password</label>
        <input type="password" id="confirm_password" class="form-control" placeholder="Confirm your new password">
    </div>
    <button id="change-password-btn" class="btn btn-success">Change Password</button>
</div>

<script>
    document.getElementById('send-code-btn').addEventListener('click', function () {
        fetch('/send-verification-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({})
        }).then(response => response.json()).then(data => {
            if (data.success) {
                alert("Verification code sent!");
                document.getElementById('verification-section').style.display = 'block';
            } else {
                alert("Failed to send verification code. Try again.");
            }
        });
    });

    document.getElementById('verify-code-btn').addEventListener('click', function () {
        const verificationCode = document.getElementById('verification_code').value;
        fetch('/verify-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ code: verificationCode })
        }).then(response => response.json()).then(data => {
            if (data.success) {
                alert("Verification successful!");
                document.getElementById('password-section').style.display = 'block';
            } else {
                alert("Invalid verification code. Please try again.");
            }
        });
    });

    document.getElementById('change-password-btn').addEventListener('click', function () {
        const newPassword = document.getElementById('new_password').value;
        const confirmPassword = document.getElementById('confirm_password').value;

        if (newPassword !== confirmPassword) {
            alert("Passwords do not match!");
            return;
        }

        fetch('/change-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password: newPassword })
        }).then(response => response.json()).then(data => {
            if (data.success) {
                alert("Password updated successfully!");
            } else {
                alert("Failed to update password. Try again.");
            }
        });
    });
</script>
{% endblock %}
